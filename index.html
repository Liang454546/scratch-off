<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Âè∞ÁÅ£ÁôºÂ§ßË≤°ÂàÆÂàÆÊ®ÇÊ®°Êì¨Âô® (ÁúüÂØ¶Ê©üÁéáÁâà)</title>
    <meta name="description" content="Êì¨ÁúüÂè∞ÁÅ£ÂàÆÂàÆÊ®ÇÊ®°Êì¨Âô®ÔºåÈ´îÈ©óÁúüÂØ¶Ê©üÁéáÁöÑÊÆòÈÖ∑Ëàá‰∏≠Â§ßÁçéÁöÑÂø´ÊÑüÔºÅ">
    
    <!-- 1. ÂºïÂÖ• Tailwind CSS (Ê®£Âºè) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. ÂºïÂÖ• React Âíå ReactDOM (Ê†∏ÂøÉÊ°ÜÊû∂) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 3. ÂºïÂÖ• Babel (ËÆìÁÄèË¶ΩÂô®ËÉΩÁúãÊáÇ JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 4. Ë®≠ÂÆöÂ≠óÂûã -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Noto+Serif+TC:wght@700;900&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            touch-action: manipulation; /* ÂÑ™ÂåñÊâãÊ©üËß∏Êéß */
            -webkit-tap-highlight-color: transparent;
        }
        
        /* ÂãïÁï´Ë®≠ÂÆö */
        @keyframes fade-in { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes slide-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse-slow { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes confetti { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        @keyframes float-up-fade { 
            0% { opacity: 1; transform: translateY(0) scale(1); } 
            100% { opacity: 0; transform: translateY(-30px) scale(1.2); } 
        }
        
        .animate-fade-in { animation: fade-in 0.3s ease-out forwards; }
        .animate-slide-up { animation: slide-up 0.4s ease-out forwards; }
        .animate-pulse-slow { animation: pulse-slow 3s infinite; }
        .animate-confetti { animation: confetti linear forwards; }
        .animate-float-up { animation: float-up-fade 0.8s ease-out forwards; }

        /* Èö±ËóèÊªæÂãïÊ¢ù */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-stone-950 text-white selection:bg-yellow-500 selection:text-black">
    
    <!-- React ÊáâÁî®Á®ãÂºèÊúÉÈ°ØÁ§∫Âú®ÈÄôË£° -->
    <div id="root"></div>

    <!-- ÈÄôË£°ÈñãÂßãÊòØ React Á®ãÂºèÁ¢ºÈÇèËºØ -->
    <script type="text/babel">
        // ÂæûÂÖ®Âüü React Áâ©‰ª∂ÂèñÂæó Hook
        const { useState, useEffect, useRef, useCallback } = React;

        // --- 1. ÂúñÁ§∫ÂÖÉ‰ª∂ÂçÄ ---
        const IconBase = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        
        const Coins = (props) => <IconBase {...props}><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m16.71 13.88.7.71-2.82 2.82"/></IconBase>;
        const RefreshCw = (props) => <IconBase {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></IconBase>;
        const RotateCcw = (props) => <IconBase {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></IconBase>;
        const Wallet = (props) => <IconBase {...props}><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"/><path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"/></IconBase>;
        const Award = (props) => <IconBase {...props}><circle cx="12" cy="8" r="6"/><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/></IconBase>;
        const Volume2 = (props) => <IconBase {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></IconBase>;
        const VolumeX = (props) => <IconBase {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line x1="23" x2="17" y1="9" y2="15"/><line x1="17" x2="23" y1="9" y2="15"/></IconBase>;
        const Zap = (props) => <IconBase {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></IconBase>;


        // --- 2. Â∑•ÂÖ∑ÂáΩÊï∏ÂçÄ ---
        const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

        const formatMoney = (amount) => {
            return new Intl.NumberFormat('zh-TW', {
                style: 'currency',
                currency: 'TWD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0,
            }).format(amount);
        };

        // Âä†Ê¨äÈö®Ê©üÊäΩÊ®£ (ÂØ¶ÁèæÁúüÂØ¶Ê©üÁéáÁöÑÊ†∏ÂøÉ)
        const getWeightedRandom = (items) => {
            const totalWeight = items.reduce((acc, item) => acc + item.weight, 0);
            let random = Math.random() * totalWeight;
            
            for (const item of items) {
                random -= item.weight;
                if (random <= 0) {
                    return item.val;
                }
            }
            return items[0].val; 
        };

        // Èü≥ÊïàÁ≥ªÁµ±
        const playSound = (type) => {
            if (typeof window === 'undefined') return;
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();

            osc.connect(gain);
            gain.connect(ctx.destination);

            if (type === 'scratch') {
                const bufferSize = ctx.sampleRate * 0.1;
                const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
                const data = buffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) { data[i] = Math.random() * 2 - 1; }
                const noise = ctx.createBufferSource();
                noise.buffer = buffer;
                const noiseGain = ctx.createGain();
                noiseGain.gain.setValueAtTime(0.05, ctx.currentTime);
                noiseGain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                noise.connect(noiseGain);
                noiseGain.connect(ctx.destination);
                noise.start();
                return;
            }

            if (type === 'win') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(523.25, ctx.currentTime);
                osc.frequency.linearRampToValueAtTime(659.25, ctx.currentTime + 0.1);
                osc.frequency.linearRampToValueAtTime(783.99, ctx.currentTime + 0.2);
                osc.frequency.linearRampToValueAtTime(1046.50, ctx.currentTime + 0.3);
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.6);
                osc.start();
                osc.stop(ctx.currentTime + 0.6);
            }
            
            if (type === 'select') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(440, ctx.currentTime);
                gain.gain.setValueAtTime(0.05, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.1);
                osc.start();
                osc.stop(ctx.currentTime + 0.1);
            }
            
            if (type === 'coin') {
                // ÈáëÂπ£ËÅ≤ (ÂÑ≤ÂÄºÁî®)
                osc.type = 'sine';
                osc.frequency.setValueAtTime(1000, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1500, ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.3);
                osc.start();
                osc.stop(ctx.currentTime + 0.3);
            }
        };

        // --- 3. Ê†∏ÂøÉÈÇèËºØÂçÄ (ÁúüÂØ¶Ê©üÁéáÁâà) ---
        const generateTicketData = (cost) => {
            let ticket = {
                id: Date.now(),
                cost: cost,
                luckyNumbers: [],
                myNumbers: [],
                bonusArea: null,
                maxPrize: 0,
                wonAmount: 0,
                isWin: false,
                theme: '',
                winType: 'normal',
            };

            // ÂÆöÁæ©ÁúüÂØ¶‰∏ñÁïåÁöÑÁçéÈáëÁµêÊßã
            let payoutTable = [];
            
            // $100 ÂΩ©Âà∏
            if (cost === 100) {
                ticket.theme = { name: 'Â•ΩÈÅãÊó∫Êó∫‰æÜ', bg: 'from-red-500 to-orange-500', border: 'border-yellow-200', text: 'text-white' };
                ticket.maxPrize = 300000;
                payoutTable = [
                    { val: 0, weight: 7200 }, { val: 100, weight: 2000 }, { val: 200, weight: 600 },
                    { val: 300, weight: 150 }, { val: 500, weight: 45 }, { val: 1000, weight: 4 },
                    { val: 300000, weight: 1 }
                ];
                ticket.luckyCount = 1; ticket.myCount = 5;
            } 
            // $200 ÂΩ©Âà∏
            else if (cost === 200) {
                ticket.theme = { name: 'ÁôºÂ§ßË≤°', bg: 'from-red-700 to-red-900', border: 'border-yellow-400', text: 'text-yellow-100' };
                ticket.maxPrize = 2000000;
                payoutTable = [
                    { val: 0, weight: 6800 }, { val: 200, weight: 2200 }, { val: 300, weight: 200 },
                    { val: 500, weight: 500 }, { val: 1000, weight: 200 }, { val: 2000, weight: 80 },
                    { val: 5000, weight: 19 }, { val: 2000000, weight: 1 }
                ];
                ticket.luckyCount = 2; ticket.myCount = 10;
            } 
            // $500 ÂΩ©Âà∏
            else if (cost === 500) {
                ticket.theme = { name: '‰∫îË∑ØË≤°Á•û', bg: 'from-yellow-600 to-yellow-800', border: 'border-red-500', text: 'text-white' };
                ticket.maxPrize = 5000000;
                payoutTable = [
                    { val: 0, weight: 6000 }, { val: 500, weight: 2500 }, { val: 600, weight: 500 },
                    { val: 1000, weight: 700 }, { val: 1500, weight: 200 }, { val: 5000, weight: 90 },
                    { val: 50000, weight: 9 }, { val: 5000000, weight: 1 }
                ];
                ticket.luckyCount = 3; ticket.myCount = 15;
            } 
            // $2000 ÂΩ©Âà∏
            else if (cost === 2000) {
                ticket.theme = { name: '2000Ëê¨Ë∂ÖÁ¥öÁ¥ÖÂåÖ', bg: 'from-purple-900 via-red-900 to-yellow-900', border: 'border-yellow-300', text: 'text-yellow-200' };
                ticket.maxPrize = 20000000;
                payoutTable = [
                    { val: 0, weight: 3100 }, { val: 1000, weight: 4000 }, { val: 2000, weight: 2000 },
                    { val: 5000, weight: 800 }, { val: 10000, weight: 90 }, { val: 100000, weight: 9 },
                    { val: 1000000, weight: 1 }, { val: 20000000, weight: 0.1 }
                ];
                ticket.luckyCount = 5; ticket.myCount = 25; ticket.hasInstantWinSymbol = true;
            } 
            // $5000 ÂΩ©Âà∏
            else if (cost === 5000) {
                ticket.theme = { name: 'Ë≤°ÂØåËá™Áî±', bg: 'from-slate-900 via-slate-800 to-yellow-600', border: 'border-white', text: 'text-yellow-400' };
                ticket.maxPrize = 50000000;
                payoutTable = [
                    { val: 0, weight: 5000 }, { val: 5000, weight: 3000 }, { val: 10000, weight: 1500 },
                    { val: 20000, weight: 400 }, { val: 50000, weight: 90 }, { val: 1000000, weight: 9 },
                    { val: 50000000, weight: 1 }
                ];
                ticket.luckyCount = 6; ticket.myCount = 30; ticket.hasBonus = true; ticket.hasInstantWinSymbol = true;
            }

            let totalWin = getWeightedRandom(payoutTable);
            ticket.wonAmount = totalWin;
            ticket.isWin = totalWin > 0;

            const pool = Array.from({ length: 60 }, (_, i) => i + 1);
            const shuffledPool = [...pool].sort(() => 0.5 - Math.random());
            ticket.luckyNumbers = shuffledPool.slice(0, ticket.luckyCount || 3);

            let remainingWin = totalWin;
            let bonusWin = 0;

            if (ticket.hasBonus && remainingWin > 0 && Math.random() < 0.3) {
                if (remainingWin >= 5000) {
                    bonusWin = 5000;
                    remainingWin -= 5000;
                }
            }
            
            if (ticket.hasBonus) {
                ticket.bonusArea = {
                    amount: bonusWin,
                    text: bonusWin > 0 ? formatMoney(bonusWin) : "ÈäòË¨ùÊÉ†È°ß",
                    isWin: bonusWin > 0
                };
            }

            let winningSpotsCount = 0;
            if (remainingWin > 0) {
                if (remainingWin <= cost) winningSpotsCount = 1;
                else winningSpotsCount = randomInt(1, Math.min(5, ticket.myCount));
            }

            let spots = [];
            for (let i = 0; i < winningSpotsCount; i++) {
                let spotWin = 0;
                if (i === winningSpotsCount - 1) {
                    spotWin = remainingWin;
                } else {
                    let slice = Math.floor(remainingWin / (winningSpotsCount - i));
                    slice = Math.floor(slice / 100) * 100; 
                    if (slice <= 0) slice = 0;
                    spotWin = slice;
                    remainingWin -= slice;
                }
                spots.push({ isWin: true, prize: spotWin });
            }

            const losingSpotsCount = ticket.myCount - winningSpotsCount;
            for (let i = 0; i < losingSpotsCount; i++) {
                let fakePrize = payoutTable[randomInt(1, payoutTable.length - 1)].val;
                spots.push({ isWin: false, prize: fakePrize });
            }

            spots.sort(() => 0.5 - Math.random());

            let remainingNumbers = shuffledPool.slice(ticket.luckyCount);
            
            ticket.myNumbers = spots.map((spot, idx) => {
                let num, isMatch = false, isInstantWin = false, symbol = null;
                
                if (spot.isWin) {
                    if (ticket.hasInstantWinSymbol && Math.random() < 0.15) {
                        isInstantWin = true; symbol = 'üí∞'; num = 0;
                    } else {
                        num = ticket.luckyNumbers[randomInt(0, ticket.luckyCount - 1)];
                        isMatch = true;
                    }
                } else {
                    const randIdx = randomInt(0, remainingNumbers.length - 1);
                    num = remainingNumbers[randIdx];
                    remainingNumbers.splice(randIdx, 1);
                }

                return {
                    id: `spot-${idx}`,
                    val: num,
                    prize: spot.prize,
                    isMatch: isMatch,
                    isInstantWin: isInstantWin,
                    symbol: symbol
                };
            });
            
            if (totalWin >= cost * 5) ticket.winType = 'super';
            else if (totalWin > cost) ticket.winType = 'big';
            else if (totalWin > 0) ticket.winType = 'normal';

            return ticket;
        };

        // --- 4. ÂÖÉ‰ª∂: ÂàÆÂàÆÂçÄ (Canvas) ---
        const ScratchSpot = ({ width, height, children, onReveal, isRevealedForce, soundEnabled }) => {
            const canvasRef = useRef(null);
            const [isScratched, setIsScratched] = useState(false);
            const [ctx, setCtx] = useState(null);
            const lastPlayTime = useRef(0);

            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                const context = canvas.getContext('2d');
                setCtx(context);

                const dpr = window.devicePixelRatio || 1;
                canvas.width = width * dpr;
                canvas.height = height * dpr;
                context.scale(dpr, dpr);

                const gradient = context.createLinearGradient(0, 0, width, height);
                gradient.addColorStop(0, '#e5e7eb');
                gradient.addColorStop(0.5, '#9ca3af');
                gradient.addColorStop(1, '#e5e7eb');
                context.fillStyle = gradient;
                context.fillRect(0, 0, width, height);
                
                for (let i = 0; i < 50; i++) {
                    context.fillStyle = `rgba(255,255,255,${Math.random() * 0.5})`;
                    context.fillRect(Math.random() * width, Math.random() * height, 2, 2);
                }

                context.fillStyle = '#6b7280'; 
                context.font = 'bold 10px Arial';
                context.textAlign = 'center';
                context.textBaseline = 'middle';
                
                const texts = ["$", "ÂàÆ", "TW", "WIN", "LUCKY"];
                for(let i=0; i<3; i++) {
                    context.save();
                    context.translate(Math.random() * width, Math.random() * height);
                    context.rotate((Math.random() - 0.5));
                    context.fillText(texts[i % texts.length], 0, 0);
                    context.restore();
                }

                context.globalCompositeOperation = 'destination-out';
            }, [width, height]);

            useEffect(() => {
                if (isRevealedForce && !isScratched) {
                    const canvas = canvasRef.current;
                    if (canvas) {
                        const context = canvas.getContext('2d');
                        context.clearRect(0, 0, canvas.width, canvas.height);
                        setIsScratched(true);
                    }
                }
            }, [isRevealedForce, isScratched]);

            const handleScratch = (e) => {
                if (isScratched || !ctx) return;

                const now = Date.now();
                if (soundEnabled && now - lastPlayTime.current > 80) {
                    playSound('scratch');
                    lastPlayTime.current = now;
                }

                const canvas = canvasRef.current;
                const rect = canvas.getBoundingClientRect();
                let clientX, clientY;

                if (e.type.includes('touch')) {
                    clientX = e.touches[0].clientX;
                    clientY = e.touches[0].clientY;
                } else {
                    if (e.buttons !== 1) return;
                    clientX = e.clientX;
                    clientY = e.clientY;
                }

                const x = clientX - rect.left;
                const y = clientY - rect.top;

                ctx.beginPath();
                ctx.arc(x, y, 18, 0, Math.PI * 2);
                ctx.fill();

                checkRevealPercentage();
            };

            const checkRevealPercentage = () => {
                if (isScratched) return;
                const canvas = canvasRef.current;
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                let transparentPixels = 0;
                const sampleRate = 40; 
                
                for (let i = 0; i < data.length; i += 4 * sampleRate) {
                    if (data[i + 3] < 128) transparentPixels++;
                }
                
                if (transparentPixels / (data.length / (4 * sampleRate)) > 0.35) {
                    setIsScratched(true);
                    onReveal();
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                }
            };

            return (
                <div className="relative select-none shrink-0" style={{ width, height }}>
                    <div className="absolute inset-0 flex items-center justify-center bg-white rounded-md text-black font-bold border-2 border-gray-300 shadow-inner overflow-hidden">
                        {children}
                    </div>
                    <canvas
                        ref={canvasRef}
                        className={`absolute inset-0 cursor-pointer touch-none rounded-md ${isScratched ? 'pointer-events-none opacity-0 transition-opacity duration-500' : 'opacity-100'}`}
                        style={{ width, height }}
                        onMouseDown={handleScratch}
                        onMouseMove={handleScratch}
                        onTouchStart={handleScratch}
                        onTouchMove={handleScratch}
                    />
                </div>
            );
        };

        // --- 5. ÂÖÉ‰ª∂: ÂΩ©Âà∏ÈÅ∏È†ÖÂç° ---
        const TicketOption = ({ price, name, maxPrize, bg, border = 'border-white/20', textColor = 'text-white', badge, onBuy, balance, isSmall, desc }) => {
            const canAfford = balance >= price;
            return (
                <button 
                    onClick={() => onBuy(price)}
                    disabled={!canAfford}
                    className={`w-full relative group overflow-hidden rounded-xl transition-all duration-200 active:scale-95 text-left shadow-md hover:shadow-xl
                        ${canAfford ? 'cursor-pointer' : 'opacity-50 cursor-not-allowed grayscale'}
                        ${isSmall ? 'p-0' : 'p-0.5'}
                    `}
                >
                    <div className={`absolute inset-0 ${bg}`}></div>
                    <div className="absolute inset-0 bg-gradient-to-b from-white/10 to-transparent opacity-50"></div>
                    
                    <div className={`relative h-full flex flex-col justify-between bg-white/5 backdrop-blur-[1px] rounded-[10px] border ${border} ${isSmall ? 'p-3' : 'p-4'}`}>
                        <div className="flex justify-between items-start">
                            <div className="flex items-center gap-3">
                                <div className={`flex items-center justify-center font-black shadow-inner rounded-lg border border-white/20 bg-white/10 backdrop-blur-md
                                    ${isSmall ? 'w-10 h-10 text-lg' : 'w-14 h-14 text-xl'} ${textColor}
                                `}>
                                    ${price}
                                </div>
                                <div>
                                    <h3 className={`font-black leading-tight flex items-center gap-2 ${isSmall ? 'text-md' : 'text-xl'} ${textColor} drop-shadow-md`}>
                                        {name}
                                        {badge && <span className="bg-red-600 text-white text-[9px] px-1.5 py-0.5 rounded shadow-sm animate-pulse">{badge}</span>}
                                    </h3>
                                    <p className={`${isSmall ? 'text-[10px]' : 'text-xs'} ${textColor} opacity-80 font-mono mt-0.5`}>
                                        TOP: {maxPrize}
                                    </p>
                                </div>
                            </div>
                            {!isSmall && <Coins className="text-yellow-300 opacity-80" size={28} />}
                        </div>

                        {desc && (
                            <div className="mt-3 text-[11px] text-yellow-200/80 bg-black/20 py-1 px-2 rounded border border-white/10">
                                {desc}
                            </div>
                        )}
                    </div>
                </button>
            )
        }

        // --- 6. ‰∏ªÁ®ãÂºè ---
        const TaiwanScratchLottery = () => {
            const [balance, setBalance] = useState(50000); // ÂàùÂßãÈáëÈ°ç 50000
            const [currentTicket, setCurrentTicket] = useState(null);
            const [revealedCount, setRevealedCount] = useState(0);
            const [showResult, setShowResult] = useState(false);
            const [forceRevealAll, setForceRevealAll] = useState(false);
            const [soundEnabled, setSoundEnabled] = useState(true);
            const [showTopUpAnim, setShowTopUpAnim] = useState(false); // ÂÑ≤ÂÄºÂãïÁï´ÁãÄÊÖã

            // È†òÈå¢ÂäüËÉΩ
            const handleTopUp = () => {
                playSound('coin');
                setBalance(prev => prev + 10000);
                setShowTopUpAnim(true);
                setTimeout(() => setShowTopUpAnim(false), 1000);
            };

            const buyTicket = (cost) => {
                if (balance < cost) {
                    alert("Èå¢ÂåÖÈ§òÈ°ç‰∏çË∂≥ÔºÅË´ãÊåâÂè≥‰∏äËßíÈ†òÈå¢ÔºÅ");
                    return;
                }
                playSound('select');
                const newTicket = generateTicketData(cost);
                setBalance(prev => prev - cost);
                setCurrentTicket(newTicket);
                setRevealedCount(0);
                setShowResult(false);
                setForceRevealAll(false);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const handleSpotReveal = useCallback(() => {
                setRevealedCount(prev => {
                    const newCount = prev + 1;
                    const totalSpots = currentTicket.luckyNumbers.length + currentTicket.myNumbers.length + (currentTicket.bonusArea ? 1 : 0);
                    if (newCount >= totalSpots) {
                        setTimeout(() => {
                            if (currentTicket.isWin && soundEnabled) playSound('win');
                            setShowResult(true);
                        }, 800);
                    }
                    return newCount;
                });
            }, [currentTicket, soundEnabled]);

            const handleRevealAll = () => {
                if (!currentTicket) return;
                playSound('select');
                setForceRevealAll(true);
                setTimeout(() => {
                    if (currentTicket.isWin && soundEnabled) playSound('win');
                    setShowResult(true);
                }, 1000);
            };

            const handleClaim = () => {
                if (currentTicket.wonAmount > 0) {
                    setBalance(prev => prev + currentTicket.wonAmount);
                    playSound('select');
                }
                setCurrentTicket(null);
                setShowResult(false);
            };

            // Ë®àÁÆóÊ∑®Âà© (Áî®ÊñºÁµêÁÆóÁï´Èù¢)
            const netProfit = currentTicket ? currentTicket.wonAmount - currentTicket.cost : 0;

            return (
                <div className="min-h-screen bg-stone-950 text-white font-sans pb-12">
                    {/* Header */}
                    <header className="bg-gradient-to-r from-red-900 via-red-800 to-red-900 border-b-4 border-yellow-500 shadow-xl sticky top-0 z-30">
                        <div className="max-w-lg mx-auto px-4 py-3 flex justify-between items-center">
                            <div className="flex items-center gap-2">
                                <div className="bg-yellow-500 p-2 rounded-full text-red-900 shadow-lg animate-pulse-slow">
                                    <Award size={20} strokeWidth={3} />
                                </div>
                                <div>
                                    <h1 className="font-black text-lg leading-none text-yellow-400 tracking-wider italic drop-shadow-md">Âè∞ÁÅ£ÁôºÂ§ßË≤°</h1>
                                    <span className="text-[10px] text-red-200 font-medium tracking-widest">ÁúüÂØ¶Ê©üÁéáÁâà</span>
                                </div>
                            </div>
                            
                            <div className="flex items-center gap-3">
                                <button onClick={() => setSoundEnabled(!soundEnabled)} className="text-red-200 hover:text-white">
                                    {soundEnabled ? <Volume2 size={20} /> : <VolumeX size={20} />}
                                </button>
                                <div className="relative flex items-center gap-2 bg-black/40 px-3 py-1.5 rounded-full border border-yellow-500/50 backdrop-blur-sm">
                                    <Wallet size={16} className="text-yellow-400" />
                                    <span className={`font-mono font-bold text-lg ${balance < 500 ? 'text-red-500 animate-pulse' : 'text-yellow-400'}`}>{formatMoney(balance)}</span>
                                    <button onClick={handleTopUp} className="bg-green-600 hover:bg-green-500 text-[10px] px-2 py-1 rounded text-white ml-1 font-bold active:scale-95 transition">
                                    +È†òÈå¢
                                    </button>
                                    {/* È†òÈå¢ÂãïÁï´ */}
                                    {showTopUpAnim && (
                                        <div className="absolute -bottom-8 right-0 text-green-400 font-black text-sm animate-float-up whitespace-nowrap pointer-events-none drop-shadow-md">
                                            +$10,000
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-lg mx-auto px-4 py-6 relative">
                        {!currentTicket && (
                            <div className="space-y-8 animate-fade-in">
                                <div className="text-center space-y-2 py-4">
                                    <h2 className="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-b from-yellow-300 to-yellow-600 filter drop-shadow-sm">ÈÅ∏ÊìáÊÇ®ÁöÑÂàÆÂàÆÊ®Ç</h2>
                                    <p className="text-gray-400 text-sm">ÂàùÂßãË≥áÈáë‰∫îËê¨ÔºÅÊåëÊà∞ÁúüÂØ¶Ê©üÁéáÔºÅ</p>
                                </div>

                                <div className="grid gap-5">
                                    <div className="space-y-4">
                                        <div className="flex items-center gap-2 mb-2">
                                            <Zap size={18} className="text-yellow-400 fill-yellow-400 animate-bounce" />
                                            <span className="text-yellow-400 font-bold text-sm tracking-wider">È´òÈ°çÈ†≠ÁçéÂçÄ (Êé®Ëñ¶)</span>
                                        </div>
                                        <TicketOption 
                                            price={5000} name="Ë≤°ÂØåËá™Áî±" maxPrize="5,000Ëê¨" 
                                            bg="bg-gradient-to-r from-slate-800 via-yellow-900 to-slate-900" 
                                            border="border-yellow-200"
                                            textColor="text-yellow-100"
                                            badge="ÊóóËâ¶"
                                            onBuy={buyTicket} balance={balance}
                                            desc="È´òÈ¢®Èö™ÔºÅ50% Ê©üÁéáÂÖ®Ë≥†ÔºåË¥è‰∫ÜÁõ¥Êé•ÈÄÄ‰ºëÔºÅ"
                                        />
                                        <TicketOption 
                                            price={2000} name="2000Ëê¨Ë∂ÖÁ¥öÁ¥ÖÂåÖ" maxPrize="2,000Ëê¨" 
                                            bg="bg-gradient-to-r from-purple-900 via-pink-900 to-red-900" 
                                            border="border-yellow-400"
                                            textColor="text-white"
                                            badge="ÁÜ±Èä∑"
                                            onBuy={buyTicket} balance={balance}
                                            desc="‰∏≠ÁçéÁéá 69% (‰ΩÜÂåÖÂê´Ë≥†Èå¢‰∏≠Áçé)ÔºåÈÅéÂπ¥ÂøÖÁé©ÔºÅ"
                                        />
                                    </div>

                                    <div className="border-t border-stone-700 my-2"></div>

                                    <div className="space-y-3 opacity-90">
                                        <div className="text-stone-400 font-bold text-xs mb-2 ml-1">Á∂ìÂÖ∏Áé©Ê≥ï</div>
                                        <TicketOption 
                                            price={500} name="‰∫îË∑ØË≤°Á•û" maxPrize="500Ëê¨" 
                                            bg="bg-gradient-to-r from-yellow-700 to-yellow-900" 
                                            onBuy={buyTicket} balance={balance}
                                        />
                                        <div className="grid grid-cols-2 gap-3">
                                            <TicketOption 
                                                price={200} name="ÁôºÂ§ßË≤°" maxPrize="200Ëê¨" 
                                                bg="bg-gradient-to-r from-red-700 to-red-800" 
                                                onBuy={buyTicket} balance={balance}
                                                isSmall
                                            />
                                            <TicketOption 
                                                price={100} name="Êó∫Êó∫‰æÜ" maxPrize="30Ëê¨" 
                                                bg="bg-gradient-to-r from-orange-600 to-red-600" 
                                                onBuy={buyTicket} balance={balance}
                                                isSmall
                                            />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {currentTicket && (
                            <div className="animate-slide-up space-y-4 pb-20">
                                <div className="flex justify-between items-center px-2">
                                    <button 
                                        onClick={() => { if(confirm('Â∞öÊú™ÂàÆÂÆåÔºåÁ¢∫ÂÆöË¶ÅÊîæÊ£ÑÔºü')) { setCurrentTicket(null); } }}
                                        className="text-stone-400 text-xs flex items-center gap-1 hover:text-white py-2"
                                    >
                                        <RotateCcw size={14} /> ÊîæÊ£ÑÈáçÈÅ∏
                                    </button>
                                    <button 
                                        onClick={handleRevealAll}
                                        disabled={showResult}
                                        className="bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-400 hover:to-yellow-500 text-red-900 text-sm px-5 py-2 rounded-full shadow-lg font-black transition transform active:scale-95 disabled:opacity-50 disabled:scale-100 flex items-center gap-1"
                                    >
                                        <Zap size={14} className="fill-red-900" /> ‰∏ÄÈçµÂÖ®ÂàÆ
                                    </button>
                                </div>

                                <div className={`relative w-full rounded-2xl overflow-hidden shadow-2xl border-2 ${currentTicket.theme.border} bg-gradient-to-b ${currentTicket.theme.bg} transform transition-all duration-500`}>
                                    <div className="p-5 text-center relative">
                                        <div className="absolute top-0 left-0 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-20"></div>
                                        <div className="relative z-10 flex flex-col items-center">
                                            <div className="bg-yellow-400 text-red-900 text-[10px] font-bold px-3 py-0.5 rounded-full mb-2 shadow-md border border-white/30">
                                                ÊúÄÈ´òÁçéÈáë NT${formatMoney(currentTicket.maxPrize).replace(/[^0-9,]/g, '')}
                                            </div>
                                            <h2 className={`text-4xl font-black ${currentTicket.theme.text} drop-shadow-xl tracking-wider mb-1`} style={{ fontFamily: '"Noto Serif TC", serif' }}>
                                                {currentTicket.theme.name}
                                            </h2>
                                            <div className={`text-xs ${currentTicket.theme.text} opacity-80 flex gap-4 font-mono`}>
                                                <span>PRICE: ${currentTicket.cost}</span>
                                                <span>NO. {currentTicket.id.toString().slice(-8)}</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-white mx-2 mb-2 rounded-xl p-3 pb-6 shadow-[inset_0_2px_10px_rgba(0,0,0,0.2)] relative min-h-[400px]">
                                        {currentTicket.bonusArea && (
                                            <div className="mb-4 bg-slate-100 p-2 rounded-lg border-2 border-dashed border-slate-300 relative">
                                                <div className="absolute -top-3 left-4 bg-red-600 text-white text-xs font-bold px-2 py-0.5 rounded shadow">
                                                    BONUS Âπ∏ÈÅãÂçÄ
                                                </div>
                                                <div className="flex items-center justify-between px-2 pt-2">
                                                    <div className="text-xs text-slate-500 font-bold w-2/3">
                                                        ÂàÆÂá∫ÈáëÈ°çÂç≥‰∏≠Áçé
                                                    </div>
                                                    <ScratchSpot 
                                                        width={100} height={50} 
                                                        onReveal={handleSpotReveal} 
                                                        isRevealedForce={forceRevealAll}
                                                        soundEnabled={soundEnabled}
                                                    >
                                                        <span className={`text-lg font-black ${currentTicket.bonusArea.isWin ? 'text-red-600' : 'text-slate-400'}`}>
                                                            {currentTicket.bonusArea.text}
                                                        </span>
                                                    </ScratchSpot>
                                                </div>
                                            </div>
                                        )}

                                        <div className="mb-6">
                                            <div className="flex items-center gap-2 mb-2 px-1">
                                                <div className="bg-red-600 text-white text-xs px-2 py-1 rounded font-bold">Âπ∏ÈÅãËôüÁ¢º</div>
                                                <div className="text-[10px] text-gray-400">LUCKY NUMBERS</div>
                                            </div>
                                            <div className="flex flex-wrap justify-start gap-2">
                                                {currentTicket.luckyNumbers.map((num, idx) => (
                                                    <ScratchSpot 
                                                        key={`lucky-${idx}`} width={50} height={50} 
                                                        onReveal={handleSpotReveal} isRevealedForce={forceRevealAll} soundEnabled={soundEnabled}
                                                    >
                                                        <span className="text-xl font-black text-red-600 font-mono">{String(num).padStart(2, '0')}</span>
                                                    </ScratchSpot>
                                                ))}
                                            </div>
                                        </div>

                                        <div className="flex items-center justify-center gap-4 my-4">
                                            <div className="h-px bg-gray-300 w-full"></div>
                                            <div className="text-gray-300 text-xs whitespace-nowrap font-bold">ÊÇ®ÁöÑËôüÁ¢º YOUR NUMBERS</div>
                                            <div className="h-px bg-gray-300 w-full"></div>
                                        </div>

                                        <div className={`grid gap-2 justify-items-center ${currentTicket.cost >= 2000 ? 'grid-cols-5' : 'grid-cols-3'}`}>
                                            {currentTicket.myNumbers.map((item, idx) => (
                                                <div key={item.id} className="flex flex-col items-center gap-1">
                                                    <ScratchSpot 
                                                        width={currentTicket.cost >= 2000 ? 60 : 80} 
                                                        height={currentTicket.cost >= 2000 ? 60 : 80} 
                                                        onReveal={handleSpotReveal} 
                                                        isRevealedForce={forceRevealAll}
                                                        soundEnabled={soundEnabled}
                                                    >
                                                        <div className={`flex flex-col items-center justify-center w-full h-full ${item.isMatch || item.isInstantWin ? 'bg-yellow-100' : ''}`}>
                                                            {item.isInstantWin ? (
                                                                <span className="text-3xl animate-pulse drop-shadow-sm">{item.symbol}</span>
                                                            ) : (
                                                                <span className={`font-black font-mono ${currentTicket.cost >= 2000 ? 'text-xl' : 'text-3xl'} ${item.isMatch ? 'text-red-600' : 'text-stone-800'}`}>
                                                                    {String(item.val).padStart(2, '0')}
                                                                </span>
                                                            )}
                                                            
                                                            <span className={`font-bold leading-none mt-1 ${(item.isMatch || item.isInstantWin) ? 'text-red-600' : 'text-gray-400'} ${currentTicket.cost >= 2000 ? 'text-[8px]' : 'text-[10px]'}`}>
                                                                {formatMoney(item.prize).replace('NT$', '$')}
                                                            </span>
                                                        </div>
                                                    </ScratchSpot>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    
                                    <div className="bg-black/30 p-1.5 text-center text-white/30 text-[9px]">
                                        ÂÖ¨ÁõäÂΩ©Âà∏ ‚Ä¢ ËÆìÊÑõÂÇ≥ÈÅû ‚Ä¢ Âè∞ÁÅ£Âä†Ê≤π
                                    </div>
                                </div>
                            </div>
                        )}

                        {showResult && currentTicket && (
                            <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/90 backdrop-blur-md animate-fade-in">
                                <div className="bg-white w-full max-w-sm rounded-3xl p-1 text-center shadow-2xl relative overflow-hidden">
                                    {currentTicket.isWin && <div className="absolute inset-0 border-[6px] border-yellow-400 rounded-3xl animate-pulse z-10 pointer-events-none"></div>}
                                    
                                    <div className="bg-stone-50 rounded-[20px] p-6 relative z-20">
                                        {currentTicket.isWin ? (
                                            <div className="space-y-4">
                                                <div className="absolute -top-10 left-1/2 -translate-x-1/2 text-6xl filter drop-shadow-lg animate-bounce">
                                                    {currentTicket.winType === 'super' ? 'üèÜ' : 'üéâ'}
                                                </div>
                                                <div className="pt-6">
                                                    <h2 className="text-3xl font-black text-red-600 tracking-wider">
                                                        {currentTicket.winType === 'super' ? 'Ë∂ÖÁ¥öÂ§ßÁçéÔºÅ' : 'ÊÅ≠Âñú‰∏≠Áçé'}
                                                    </h2>
                                                    <p className="text-stone-500 font-medium text-sm mt-1">
                                                        {netProfit < 0 
                                                            ? `ÈõñÁÑ∂‰∏≠‰∫ÜÔºå‰ΩÜÈÇÑÊòØËôß‰∫Ü $${Math.abs(netProfit)}...` 
                                                            : `Â§™Á•ûÂï¶ÔºÅÊ∑®Ë≥∫ $${netProfit}ÔºÅ`}
                                                    </p>
                                                </div>
                                                
                                                <div className="bg-gradient-to-r from-red-500 to-red-600 py-5 rounded-2xl text-white shadow-inner ring-4 ring-red-100">
                                                    <p className="text-xs font-bold text-red-100 uppercase opacity-80">Total Win</p>
                                                    <p className="text-4xl font-black tracking-tight">{formatMoney(currentTicket.wonAmount)}</p>
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="space-y-4 pt-4">
                                                <div className="text-stone-300">
                                                    <RefreshCw size={60} className="mx-auto" />
                                                </div>
                                                <h2 className="text-2xl font-bold text-stone-600">ÈäòË¨ùÊÉ†È°ß</h2>
                                                <p className="text-stone-400 text-sm">ÂÅöÂÖ¨Áõä Á©çÂäüÂæ∑Ôºå‰∏ãÊ¨°‰∏ÄÂÆö‰∏≠ÔºÅ</p>
                                                <div className="bg-stone-100 py-4 rounded-xl">
                                                    <p className="text-stone-500 font-mono">-$ {currentTicket.cost}</p>
                                                </div>
                                            </div>
                                        )}

                                        <div className="grid grid-cols-2 gap-3 mt-6">
                                            <button 
                                                onClick={() => setCurrentTicket(null)}
                                                className="col-span-1 bg-stone-200 hover:bg-stone-300 text-stone-600 font-bold py-3 rounded-xl transition"
                                            >
                                                ÂõûÂ§ßÂª≥
                                            </button>
                                            <button 
                                                onClick={handleClaim}
                                                className="col-span-1 bg-yellow-500 hover:bg-yellow-400 text-red-900 font-bold py-3 rounded-xl shadow-md transition transform active:scale-95"
                                            >
                                                {currentTicket.isWin ? 'È†òÁçé' : 'ÂÜçË≤∑‰∏ÄÂºµ'}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                {currentTicket.isWin && (
                                    <div className="absolute inset-0 overflow-hidden pointer-events-none">
                                        {[...Array(20)].map((_, i) => (
                                            <div 
                                                key={i} 
                                                className="absolute w-2 h-2 bg-yellow-400 rounded-full animate-confetti"
                                                style={{
                                                    left: `${Math.random() * 100}%`,
                                                    top: `-10px`,
                                                    backgroundColor: ['#FFD700', '#FF4500', '#00FF00', '#00BFFF'][Math.floor(Math.random() * 4)],
                                                    animationDelay: `${Math.random() * 2}s`,
                                                    animationDuration: `${2 + Math.random() * 3}s`
                                                }}
                                            />
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TaiwanScratchLottery />);
    </script>
</body>
</html>
